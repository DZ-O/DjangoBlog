<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
{% load static %}
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1,user-scalable=n"/>
    <script src="/static/bootstrap-3.3.7-dist/jquery-3.2.1.min.js"></script>
    <meta name="description" content=""/>
    <meta name="author" content=""/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>贝克街-详情</title>
    <link rel="shortcut icon" href="{% static 'img/favicon.ico' %}">
    <link href="/static/m_assets/css/bootstrap.css" rel="stylesheet"/>
    <link href="/static/m_assets/css/font-awesome.css" rel="stylesheet"/>
    <link href="/static/m_assets/css/style.css" rel="stylesheet"/>
    <link rel="stylesheet" href="{% static 'css/search.css' %}">
    <link rel="stylesheet" href="{% static 'css/nav.css' %}">
    <link href="/static/css/edbox.min.css" rel="stylesheet">
    <script src="/static/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
    <script src="/static/font_2823356_8mkiudkti4r/iconfont.js"></script>
    <script src="/static/js/jquery.edbox.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Montserrat+Alternates:300,400,500,600" rel="stylesheet">
    <link type="text/css" rel="stylesheet"
          href={% static "css/font-awesome.min.css" %}>
    <link type="text/css" rel="stylesheet"
          href={% static "css/ionicons.min.css" %}>
    <style>
        @import url("https://fonts.googleapis.com/css2?family=Roboto&display=swap");

        .icon {
            width: 1em;
            height: 1em;
            vertical-align: -0.15em;
            fill: currentColor;
            overflow: hidden;
        }


    </style>
</head>
<body style="overflow-x: hidden;">
<section class="header-section">
    <div class="container">
        <div class="row" style="padding: 0">
            <div class="col-md-5 text-center">
                <h1><strong>贝克街 </strong></h1>
                <h4>Blog By Dazon</h4>
            </div>
            <div class="col-md-5 text-center">
                <br> <i>
                <h4>
                    文章详情
                </h4></i>
            </div>
        </div>
    </div>
</section>

<section>
    <input type="hidden" id="article_id" value="{{ article_obj.id }}">
    <div class="container" style="margin-top: 0">
        <div class="row">
            <div class="col-md-9">
                <div class="blog-main" style="margin-bottom: 10px">
                    <div class="heading-blog text-center">
                        {{ article_obj.title }}
                    </div>

                    <div class="blog-info">

                        <a href="/article/q/?Type={{ article_type.id }}"><span
                                class="label label-success">{{ article_type.types }}</span></a>
                        {% for tag in atr_tags %}
                            <a href="/article/q/?Tag={{ tag.id }}"><span
                                    class="label label-danger">{{ tag.tag }}</span></a>
                        {% endfor %}

                        <span class="label label-info" id="like_btn">
                            <i class="fa fa-thumbs-up  "></i>+ <span id='like_count'>{{ article_obj.like_count }}</span></span>
                        <h5 class="text-center" style="margin: 10px 0;padding: 0">
                            <small>发表：{{ article_obj.create_time }}&nbsp;|&nbsp;<small>修改：{{ article_obj.revise_time }}</small></small>
                        </h5>
                        <h5 class="text-right" style="margin: 0;padding: 0"></h5>
                    </div>
                    <hr style="margin: 0;padding: 0">
                    <div class="blog-txt">
                        {{ article_obj.content|safe }}
                    </div>

                </div>
                <h3><strong>最近留言:</strong></h3>

                <div class="form-group">
                    <label class="sr-only" for="exampleInputAmount">Amount (in dollars)</label>
                    <div class="input-group">
                        <div class="input-group-addon">名称</div>
                        <input type="text" class="form-control" id="user" placeholder="（可不填）">

                    </div>
                    <textarea class="form-control" rows="3" placeholder="说点啥？" maxlength="100"
                              id="send_mes"></textarea>
                </div>
                <button type="submit" class=" btn-primary" style="float: right" id="send_btn">发送</button>
                <hr/>
                <ul class="media-list">
                    {% for article_message in page_queryset %}

                        <li class="media">

                            <div class="media-body">
                                <h4 class="media-heading">@{{ article_message.user }}:</h4>
                                <p style="color: black">
                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ article_message.message_content }}
                                </p>
                                <small style="color: darkgrey;position: relative;right: -242px">-{{ article_message.message_create_time|date:'Y-m-d H:i:s' }}</small>
                            </div>
                        </li>
                        <hr>
                    {% endfor %}


                </ul>
                <nav>
                    <div class="container text-center">{{ page_obj.page_html|safe }}</div>
                </nav>

                <!--COMMENTS SECTION END-->
            </div>


            <br/>

            <br/>

        </div>
    </div>
</section>

<div class="sidebar" style="z-index: 300;position: fixed;top: 0;width: 56px">
    <ul>
        <li><a href="/">
            <svg class="icon" aria-hidden="true">
                <use xlink:href="#icon-General-2-15-copy"></use>
            </svg>
        </a></li>
        <li><a class="" href="/article.html">
            <svg class="icon" aria-hidden="true">
                <use xlink:href="#icon-wenzhang_2-copy"></use>
            </svg>
        </a></li>
        <li><a href="" class="" data-toggle="modal" data-target="#myModal">
            <svg class="icon" aria-hidden="true">
                <use xlink:href="#icon-sousuo-copy"></use>
            </svg>
        </a></li>
        <br>
        <hr>
        <br>
        <li><a class="" target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin=2669191008&site=qq&menu=yes">
            <svg class="icon" aria-hidden="true">
                <use xlink:href="#icon-qq-copy"></use>
            </svg>
        </a></li>
        <li><a href="" id="wechat" class="link-image" data-box-header="微信">
            <svg class="icon" aria-hidden="true">
                <use xlink:href="#icon-weixin-copy"></use>
            </svg>
        </a></li>
        <li><a class="btn"></a></li>

    </ul>
</div>
<a class="btn" style="position: fixed;top: 0;float: left;pointer-events: auto;z-index: 200"></a>


<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">

    <main>
        <div class="container">
            <h1 class="ser_h1">客官想来点嘛?</h1>
            <h2 class="ser_h2">Try below!</h2>
            <div class="search-box">
                <div class="search-icon"><i class="fa fa-search search-icon"></i></div>
                <form action="/article/q/" method="get" class="search-form">
                    <input type="text" placeholder="Search" id="search" autocomplete="off" name="search_val">
                </form>
                <svg class="search-border" version="1.1" xmlns="http://www.w3.org/2000/svg"
                     xmlns:xlink="http://www.w3.org/1999/xlink"
                     xmlns:a="http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/" x="0px" y="0px" viewBox="0 0 671 111"
                     style="enable-background:new 0 0 671 111;"
                     xml:space="preserve">
          <path class="border" d="M335.5,108.5h-280c-29.3,0-53-23.7-53-53v0c0-29.3,23.7-53,53-53h280"/>
                    <path class="border" d="M335.5,108.5h280c29.3,0,53-23.7,53-53v0c0-29.3-23.7-53-53-53h-280"/>
        </svg>
                <div class="go-icon"><i class="fa fa-arrow-right"></i></div>
            </div>

        </div>
    </main>
</div>


</div>


<hr/>
<div class="container">
    <div class="row">
        <div class="col-md-12 text-center set-foot">
            &copy 2014 jhon alexan | More Templates <a href="http://www.php.cn/" target="_blank"
                                                       title="php中文网">php中文网</a> - Collect from <a
                href="http://www.php.cn/" title="网页模板" target="_blank">网页模板</a>
        </div>
    </div>
</div>

</body>
<script type="text/javascript" src="{% static 'js/nav.js' %}"></script>

<script src="{% static 'js/search.js' %}"></script>
<script>
    $('.link-image').edbox({
        image: '/static/img/wechat.png',
        zIndex: 20000
    });
</script>
<script>
    $('#like_btn').click(function () {
        $.ajax({
            url: '/like/',
            type: 'post',
            data: {
                'like_state': 'unlike',
                'article_id': $('#article_id').val(),
                'csrfmiddlewaretoken': '{{ csrf_token }}'

            },
            success: function (args) {

                if (args.error == 200) {
                    $('#like_count').text(args.likecount)

                } else if (args.error == 400) {
                    alert('点赞失败')

                }
            }
        })
    })
</script>
<script>
    $('#send_btn').click(function (e) {
        $.ajax({
            url: '/getmessage/',
            type: 'post',
            data: {
                'id': $('#article_id').val(),
                'send_mes': $('#send_mes').val(),
                'user': $('#user').val(),
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            success: function (args) {

                if (args.error == 200) {
                    str = ``
                    for (let i = 0; i < args.page_queryset.length; i++) {

                        time = args.page_queryset[i].message_create_time.split('T')
                        time[1] = time[1].split('.')[0]
                        if (i < 10) {
                            str += `<li class="media">

                                <div class="media-body">
                                    <h4 class="media-heading">@${args.page_queryset[i].user}:</h4>
                                    <p style="color: black">
                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${args.page_queryset[i].message_content}
                                    </p>
                                    <small style="color: darkgrey;position: relative;right: -242px">-
                        ${time[0] + ' ' + time[1]}</small>
                                </div>
                            </li>
                            <hr>`

                        } else {
                            break;
                        }
                    }
                    $('.media-list')[0].innerHTML = str

                } else {

                    alert(args.mes)
                }
            }
        })
    })
</script>

</html>
